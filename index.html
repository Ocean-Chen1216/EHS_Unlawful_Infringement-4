<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>è·å ´ä¸æ³•ä¾µå®³é é˜²æªæ–½æŸ¥æ ¸åŠè©•ä¼°è¡¨</title>
<link rel="icon" href="icon-192.png" type="image/png">
<link rel="manifest" href="manifest.json">
<style>
    /* === å…¨å±€æ¨£å¼åƒè€ƒè‡ª index.html === */
    body { 
        padding: 15px; 
        padding-bottom: 120px; 
        background-color: #f0f2f5; 
        font-family: -apple-system, "Microsoft JhengHei", sans-serif; 
        color: #333; 
    }
    .container { max-width: 800px; margin: 0 auto; }

    /* å¡ç‰‡ä½ˆå±€ */
    .card-box { 
        position: relative; 
        background: white; 
        padding: 25px; 
        border-radius: 12px; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
        margin-bottom: 20px; 
    }

    /* ç‰ˆæœ¬è™Ÿ (å³ä¸Šè§’) */
    .version-tag {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 0.8rem;
        color: #aaa;
    }

    /* æ¨™é¡Œèˆ‡è—ç·š */
    .app-header {
        text-align: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 3px solid #0288d1;
        padding-top: 10px;
    }
    .app-title { font-size: 1.6rem; font-weight: 900; color: #2c3e50; }

    /* å€å¡Šæ¨™é¡Œ */
    .section-title { 
        font-size: 1.2rem; font-weight: bold; color: #0288d1; 
        margin-bottom: 15px; border-left: 5px solid #0288d1; padding-left: 10px;
    }

    label { font-weight: bold; color: #555; margin-bottom: 5px; display: block; }
    input[type="date"], textarea { 
        width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 8px; 
        font-size: 16px; margin-bottom: 10px; box-sizing: border-box; background: #fff;
    }

    /* æª¢æŸ¥åˆ—æ¨£å¼ */
    .check-item-row { padding: 15px 0; border-bottom: 1px dashed #eee; }
    .check-item-row:last-child { border-bottom: none; }
    .point-label { font-size: 1.05rem; font-weight: bold; margin-bottom: 10px; display: block; }

    /* æŒ‰éˆ•é¡è‰²ç‹€æ…‹ä¿®æ­£ */
    .btn-group-toggle { display: flex; gap: 8px; margin-bottom: 10px; }
    .btn-check { 
        flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; 
        cursor: pointer; text-align: center; font-weight: bold; background: #fafafa; 
        transition: 0.2s; font-size: 0.85rem; color: #666;
    }
    /* ä¿®æ­£ç¶ è‰²é¡¯ç¤ºå•é¡Œ */
    .btn-check.active-done { background: #198754; color: white; border-color: #198754; }
    .btn-check.active-doing { background: #ffc107; color: #000; border-color: #ffc107; }
    .btn-check.active-none { background: #dc3545; color: white; border-color: #dc3545; }

    /* ç°½åæ¿ */
    .sig-wrapper { border: 2px dashed #ccc; border-radius: 8px; background: #fff; height: 180px; }
    canvas { width: 100%; height: 100%; cursor: crosshair; touch-action: none; }

    /* FAB æ‡¸æµ®æŒ‰éˆ• */
    .fab-container { position: fixed; bottom: 25px; right: 25px; display: flex; flex-direction: column; gap: 10px; z-index: 1000; align-items: flex-end; }
    .btn-float { 
        display: flex; align-items: center; justify-content: center; padding: 10px 20px; 
        border-radius: 50px; color: white; font-weight: bold; border: none; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.3); cursor: pointer; min-width: 130px; transition: 0.2s;
        font-size: 0.95rem;
    }
    .btn-main { background: linear-gradient(135deg, #0288d1, #03a9f4); }
    .btn-gray { background: linear-gradient(135deg, #6c757d, #7f8c8d); }
    .btn-warn { background: linear-gradient(135deg, #c0392b, #e74c3c); }
</style>
</head>
<body>

<div class="fab-container">
    <button class="btn-float btn-gray" onclick="exportBackup()">ğŸ’¾ ä¸‹è¼‰å‚™ä»½ (JSON)</button>
    <button class="btn-float btn-gray" onclick="document.getElementById('importFile').click()">ğŸ“‚ è®€å–å‚™ä»½</button>
    <button class="btn-float btn-main" onclick="downloadReport()">ğŸ“¥ ä¸‹è¼‰æŸ¥æ ¸å ±å‘Š</button>
    <button class="btn-float btn-warn" onclick="clearDraft()">ğŸ—‘ï¸ æ¸…é™¤é‡å¡«</button>
</div>
<input type="file" id="importFile" accept=".json" style="display: none;" onchange="importBackup(this)">

<div class="container">
    <div class="card-box">
        <div class="version-tag">v7.1 (å ±å‘Šæ¨£å¼çµ±ä¸€ç‰ˆ)</div>
        <div class="app-header">
            <div class="app-title">è·å ´ä¸æ³•ä¾µå®³é é˜²æªæ–½æŸ¥æ ¸åŠè©•ä¼°è¡¨</div>
            <small id="saveStatus" style="color:green; display:none;">âœ… å·²è‡ªå‹•å„²å­˜</small>
        </div>

        <div class="section-title">1. è©•ä¼°è³‡æ–™</div>
        <label>æŸ¥æ ¸æ—¥æœŸ Date</label>
        <input type="date" id="evalDate" onchange="autoSave()">
    </div>

    <div id="dynamicSections"></div>

    <div class="card-box">
        <div class="section-title">8. è·å®‰äººå“¡ç°½ç« </div>
        <div class="sig-wrapper">
            <canvas id="sigCanvas"></canvas>
        </div>
        <button type="button" style="margin-top:10px; border:none; background:#eee; padding:5px 15px; border-radius:20px; cursor:pointer;" onclick="clearSig()">â†º æ¸…é™¤é‡ç°½</button>
    </div>
</div>

<script>
// --- 1. è³‡æ–™çµæ§‹èˆ‡å°ˆå±¬æç¤ºè© (å°æ‡‰é™„ä»¶ä¸ƒ) ---
const checkData = [
    { 
        id: 2, title: "è¾¨è­˜åŠè©•ä¼°å±å®³", 
        items: [
            { p: "çµ„ç¹”", hint: "ä¾‹å¦‚ï¼šçµ±è¨ˆå„éƒ¨é–€é¢¨éšªåˆ†ä½ˆç‹€æ³ã€é«˜é¢¨éšªå–®ä½è¨ªè«‡ç´€éŒ„... [cite: 63, 153]" },
            { p: "å€‹äººå› ç´ ", hint: "ä¾‹å¦‚ï¼šæ˜¯å¦å·²è¾¨è­˜å…·æƒ…ç·’ä¸ç©©æˆ–ç‰¹å®šç—…å²å“¡å·¥ä¸¦é€²è¡Œå¥åº·è¿½è¹¤... [cite: 168]" },
            { p: "å·¥ä½œç’°å¢ƒ", hint: "ä¾‹å¦‚ï¼šæ˜¯å¦å·²é€éç’°å¢ƒæª¢é»è¡¨è­˜åˆ¥ç…§æ˜ä¸è¶³ã€è¦–é‡æ­»è§’å€åŸŸ... [cite: 71, 152]" },
            { p: "å·¥ä½œæµç¨‹", hint: "ä¾‹å¦‚ï¼šæª¢è¦–æ·±å¤œ/å‡Œæ™¨ä½œæ¥­æµç¨‹æ˜¯å¦å·²æœ‰è‡ªæˆ‘é˜²è¡›å·¥å…·èˆ‡æ©Ÿåˆ¶... [cite: 83, 151]" }
        ]
    },
    { 
        id: 3, title: "é©ç•¶é…ç½®ä½œæ¥­å ´æ‰€", 
        items: [
            { p: "ç‰©ç†ç’°å¢ƒ", hint: "ä¾‹å¦‚ï¼šç…§æ˜æ”¹å–„ï¼ˆå„å€åŸŸè¦–é‡æ¸…æ™°ï¼‰ã€å™ªéŸ³æ§åˆ¶ï¼ˆ80åˆ†è²ä»¥ä¸‹ï¼‰... [cite: 69, 71]" },
            { p: "å·¥ä½œå ´æ‰€è¨­è¨ˆ", hint: "ä¾‹å¦‚ï¼šå·²å®Œæˆé€šé“éšœç¤™æ¸…é™¤ã€å¢è¨­é–€ç¦ç®¡åˆ¶èˆ‡ç›£è¦–ç³»çµ±... [cite: 75, 78]" }
        ]
    },
    { 
        id: 4, title: "ä¾å·¥ä½œé©æ€§é©ç•¶èª¿æ•´äººåŠ›", 
        items: [
            { p: "é©æ€§é…å·¥", hint: "ä¾‹å¦‚ï¼šé‡å°æ·±å¤œæˆ–å–®ç¨ä½œæ¥­å®‰æ’å…©äººå”åŒï¼Œæˆ–èª¿æ•´é«˜é¢¨éšªè·å‹™å…§å®¹... [cite: 83, 84]" },
            { p: "å·¥ä½œè¨­è¨ˆ", hint: "ä¾‹å¦‚ï¼šç°¡åŒ–èˆ‡å…¬çœ¾æ¥è§¸ä¹‹æœå‹™æµç¨‹ï¼Œæ¸›å°‘äº’å‹•éç¨‹è¡çªæ‘©æ“¦... [cite: 86]" }
        ]
    },
    { 
        id: 5, title: "å»ºæ§‹è¡Œç‚ºè¦ç¯„", 
        items: [
            { p: "çµ„ç¹”æ”¿ç­–è¦ç¯„", hint: "ä¾‹å¦‚ï¼šè² è²¬äººå·²ç°½ç½²ã€Œé›¶å®¹å¿ã€è²æ˜ä¸¦å…¬å‘Šæ–¼è¾¦å…¬å€åŸŸ... [cite: 29, 60]" },
            { p: "å€‹äººè¡Œç‚ºè¦ç¯„", hint: "ä¾‹å¦‚ï¼šå·²æ–¼å“¡å·¥æ‰‹å†Šå¢è¨‚è·å ´ä¸æ³•ä¾µå®³æ‡²æˆ’èˆ‡ç”³è¨´æ¢æ¬¾... [cite: 55]" }
        ]
    },
    { 
        id: 6, title: "è¾¦ç†å±å®³é é˜²åŠæ•™è‚²è¨“ç·´", 
        items: [
            { p: "æ•™è‚²è¨“ç·´å ´æ¬¡", hint: "ä¾‹å¦‚ï¼šæœ¬å¹´åº¦å·²è¾¦ç†å ´æ¬¡ã€å—è¨“äººæ•¸çµ±è¨ˆèˆ‡ç°½åˆ°è¡¨ç´€éŒ„... [cite: 36, 89]" },
            { p: "æ•™è‚²è¨“ç·´å…§å®¹", hint: "ä¾‹å¦‚ï¼šå…§å®¹æ¶µè“‹ä¸æ³•ä¾µå®³è¾¨è­˜ã€æºé€šæŠ€å·§åŠæ³•å¾‹æ¬Šç›Šå®£å°... [cite: 89]" },
            { p: "æƒ…å¢ƒæ¨¡æ“¬ã€æ¼”ç·´", hint: "ä¾‹å¦‚ï¼šé‡å°é«˜é¢¨éšªå–®ä½ï¼ˆå¦‚æ«ƒæª¯ã€æ¨£å“å®¤ï¼‰è¾¦ç†æƒ…å¢ƒæ¨¡æ“¬æ¼”ç·´ç´€éŒ„..." },
            { p: "è£½ä½œæ‰‹å†Šæˆ–æŒ‡å¼•ä¸¦å…¬å‘Š", hint: "ä¾‹å¦‚ï¼šå°è£½æ‡¶äººåŒ…åœ–å¡ã€ç”³è¨´æµç¨‹è²¼ç´™ç­‰å®£å°ç‰©å“ç™¼æ”¾..." }
        ]
    },
    { 
        id: 7, title: "å»ºç«‹äº‹ä»¶è™•ç†ç¨‹åº", 
        items: [
            { p: "å»ºç«‹ç”³è¨´æˆ–é€šå ±æ©Ÿåˆ¶", hint: "ä¾‹å¦‚ï¼šç”³è¨´å°ˆç·š/é›»å­ä¿¡ç®±é‹ä½œæ­£å¸¸ã€åŒ¿åä¿è­·æ©Ÿåˆ¶æ¸¬è©¦ç´€éŒ„... [cite: 94, 97]" },
            { p: "é€šå ±è™•ç½®", hint: "ä¾‹å¦‚ï¼šæ˜å®šæ¥ç²é€šå ±å¾Œ3æ—¥å…§æ‡‰å•Ÿå‹•èª¿æŸ¥å°çµ„ä¹‹SOP... [cite: 97]" },
            { p: "æ¯ä½åŒä»æ¸…æ¥šé€šå ±æµç¨‹", hint: "ä¾‹å¦‚ï¼šæŠ½æ¸¬å“¡å·¥å°æ–¼ç”³è¨´ç®¡é“çš„çŸ¥æ‚‰åº¦åˆæ ¼ç´€éŒ„... [cite: 525]" },
            { p: "ç›¸é—œè³‡æºé€£çµ", hint: "ä¾‹å¦‚ï¼šå·²æ›´æ–°å¤–éƒ¨æ³•å¾‹è«®è©¢ï¼ˆå¦‚æ³•æ‰¶ï¼‰åŠå¿ƒç†è«®å•†ä¹‹è¯çµ¡æ¸…å†Š... [cite: 516]" },
            { p: "ç´€éŒ„ç´€éŒ„å­˜æª”", hint: "ä¾‹å¦‚ï¼šé€šå ±å–®ã€èª¿æŸ¥å ±å‘Šç­‰æ–‡ä»¶çš†æ­¸æª”å­˜æ”¾ï¼Œä¸¦è‡³å°‘ä¿å­˜3å¹´... [cite: 102]" }
        ]
    },
    { 
        id: 8, title: "åŸ·è¡Œæˆæ•ˆä¹‹è©•ä¼°åŠæ”¹å–„", 
        items: [
            { p: "å®šæœŸå¯©è¦–è©•ä¼°æˆæ•ˆ", hint: "ä¾‹å¦‚ï¼šæ¯2å¹´å®šæœŸæª¢è¨ä¸æ³•ä¾µå®³é é˜²è¨ˆç•«ä¹‹é©ç”¨æ€§... [cite: 104]" },
            { p: "ç›¸é—œè³‡æ–™çµ±è¨ˆåˆ†æ", hint: "ä¾‹å¦‚ï¼šå¹´åº¦é›¶é€šå ±æˆ–ç•°å¸¸ä»¶æ•¸è¶¨å‹¢åˆ†æå ±å‘Š... [cite: 105]" },
            { p: "äº‹ä»¶è™•ç†åˆ†æ", hint: "ä¾‹å¦‚ï¼šé‡å°éå¾€å€‹æ¡ˆåˆ†æåŸå› ä¸¦ä¿®æ­£ç›¸é—œç‰©ç†æˆ–è¡Œæ”¿ç®¡åˆ¶æªæ–½... [cite: 105]" },
            { p: "å ±å‘Šæˆæœ", hint: "ä¾‹å¦‚ï¼šæŸ¥æ ¸çµæœæå ±è‡³è·æ¥­å®‰å…¨è¡›ç”Ÿå§”å“¡æœƒè­°å¯©æ ¸ç´€éŒ„... [cite: 108]" },
            { p: "ç´€éŒ„", hint: "ä¾‹å¦‚ï¼šæœƒè­°ç´€éŒ„åŠæœ¬è¡¨ï¼ˆé™„ä»¶ä¸ƒï¼‰ç°½æ ¸å®Œæˆå¾Œæ­¸æª”... [cite: 105]" }
        ]
    }
];

// --- 2. åˆå§‹åŒ– IndexedDB èˆ‡ è¡¨å–® ---
const DB_NAME = "Attachment7_Final";
let db;
const request = indexedDB.open(DB_NAME, 1);
request.onupgradeneeded = e => e.target.result.createObjectStore("drafts", { keyPath: "id" });
request.onsuccess = e => { db = e.target.result; renderForm(); loadDraft(); };

function renderForm() {
    const container = document.getElementById('dynamicSections');
    document.getElementById('evalDate').valueAsDate = new Date();
    
    checkData.forEach(sect => {
        let html = `<div class="card-box"><div class="section-title">${sect.id}. ${sect.title}</div>`;
        sect.items.forEach((item, idx) => {
            const key = `s${sect.id}_p${idx}`;
            html += `
                <div class="check-item-row">
                    <span class="point-label">â— ${item.p}</span>
                    <div class="btn-group-toggle">
                        <div class="btn-check" id="${key}_done" onclick="setRes('${key}', 'å®Œæˆ')">å®Œæˆ</div>
                        <div class="btn-check" id="${key}_doing" onclick="setRes('${key}', 'åŸ·è¡Œä¸­')">åŸ·è¡Œä¸­</div>
                        <div class="btn-check" id="${key}_none" onclick="setRes('${key}', 'æœªåŸ·è¡Œ')">æœªåŸ·è¡Œ</div>
                    </div>
                    <input type="hidden" id="val_${key}" value="">
                    <textarea id="note_${key}" placeholder="${item.hint}" oninput="autoSave()"></textarea>
                </div>`;
        });
        html += `</div>`;
        container.innerHTML += html;
    });
}

function setRes(key, val) {
    const done = document.getElementById(`${key}_done`);
    const doing = document.getElementById(`${key}_doing`);
    const none = document.getElementById(`${key}_none`);
    const hidden = document.getElementById(`val_${key}`);
    
    [done, doing, none].forEach(b => b.className = 'btn-check');
    
    if(val === 'å®Œæˆ') done.className = 'btn-check active-done'; // ä¿®æ­£é¡è‰²å•é¡Œ
    else if(val === 'åŸ·è¡Œä¸­') doing.className = 'btn-check active-doing';
    else if(val === 'æœªåŸ·è¡Œ') none.className = 'btn-check active-none';
    
    hidden.value = val;
    autoSave();
}

// --- 3. è‡ªå‹•å„²å­˜èˆ‡æ¸…é™¤åŠŸèƒ½ ---
let saveTimer;
function autoSave() {
    clearTimeout(saveTimer);
    saveTimer = setTimeout(saveToDB, 500);
}

function saveToDB() {
    if(!db) return;
    const data = {
        id: "current_draft",
        date: document.getElementById('evalDate').value,
        results: Array.from(document.querySelectorAll('input[type="hidden"]')).reduce((acc, el) => ({...acc, [el.id]: el.value}), {}),
        notes: Array.from(document.querySelectorAll('textarea')).reduce((acc, el) => ({...acc, [el.id]: el.value}), {}),
        signature: isCanvasBlank() ? null : canvas.toDataURL()
    };
    db.transaction(["drafts"], "readwrite").objectStore("drafts").put(data);
    const status = document.getElementById('saveStatus');
    status.style.display = 'inline';
    setTimeout(() => status.style.display = 'none', 1500);
}

function loadDraft() {
    db.transaction(["drafts"]).objectStore("drafts").get("current_draft").onsuccess = e => {
        const d = e.target.result; if(!d) return;
        if(d.date) document.getElementById('evalDate').value = d.date;
        Object.keys(d.results).forEach(k => {
            const key = k.replace('val_', '');
            if(d.results[k]) setRes(key, d.results[k]);
        });
        Object.keys(d.notes).forEach(k => document.getElementById(k).value = d.notes[k]);
        if(d.signature) { const i = new Image(); i.src = d.signature; i.onload = () => ctx.drawImage(i, 0, 0); }
    };
}

function clearDraft() {
    if(confirm("ç¢ºå®šè¦ã€æ¸…é™¤é‡å¡«ã€‘å—ï¼Ÿé€™å°‡åˆªé™¤æ‰€æœ‰é¸é …ã€æ–‡å­—èˆ‡ç°½åæ¿å…§å®¹ã€‚")) {
        db.transaction(["drafts"], "readwrite").objectStore("drafts").delete("current_draft");
        document.querySelectorAll('input[type="hidden"]').forEach(el => el.value = "");
        document.querySelectorAll('.btn-check').forEach(el => el.className = "btn-check");
        document.querySelectorAll('textarea').forEach(el => el.value = "");
        clearSig();
        alert("è³‡æ–™å·²é‡ç½®ï¼");
    }
}

// --- 4. å‚™ä»½åŠŸèƒ½ ---
function exportBackup() {
    db.transaction(["drafts"]).objectStore("drafts").get("current_draft").onsuccess = e => {
        const a = document.createElement('a');
        a.href = URL.createObjectURL(new Blob([JSON.stringify(e.target.result)], {type: "application/json"}));
        a.download = `é™„ä»¶ä¸ƒå‚™ä»½_${document.getElementById('evalDate').value}.json`;
        a.click();
    };
}

function importBackup(input) {
    const reader = new FileReader();
    reader.onload = e => {
        const data = JSON.parse(e.target.result);
        db.transaction(["drafts"], "readwrite").objectStore("drafts").put(data).oncomplete = () => location.reload();
    };
    reader.readAsText(input.files[0]);
}

// --- 5. ç°½åæ¿èˆ‡å ±å‘Šç”Ÿæˆ ---
const canvas = document.getElementById('sigCanvas');
const ctx = canvas.getContext('2d');
let drawing = false;

function initCanvas() {
    canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;
    ctx.lineWidth = 3; ctx.lineCap = 'round'; ctx.strokeStyle = '#000';
}
window.addEventListener('resize', initCanvas);
setTimeout(initCanvas, 500);

function startDraw(e) { drawing = true; ctx.beginPath(); const p = getPos(e); ctx.moveTo(p.x, p.y); }
function draw(e) { if(!drawing) return; const p = getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); }
function stopDraw() { drawing = false; autoSave(); }
function getPos(e) { 
    const r = canvas.getBoundingClientRect();
    const cx = e.touches ? e.touches[0].clientX : e.clientX;
    const cy = e.touches ? e.touches[0].clientY : e.clientY;
    return { x: cx - r.left, y: cy - r.top }; 
}
canvas.addEventListener('mousedown', startDraw); canvas.addEventListener('mousemove', draw); canvas.addEventListener('mouseup', stopDraw);
canvas.addEventListener('touchstart', startDraw, {passive:false}); canvas.addEventListener('touchmove', draw, {passive:false}); canvas.addEventListener('touchend', stopDraw);

function clearSig() { ctx.clearRect(0,0,canvas.width,canvas.height); autoSave(); }
function isCanvasBlank() { const b = document.createElement('canvas'); b.width = canvas.width; b.height = canvas.height; return canvas.toDataURL() === b.toDataURL(); }

function downloadReport() {
    let rows = "";
    let counts = { "å®Œæˆ": 0, "åŸ·è¡Œä¸­": 0, "æœªåŸ·è¡Œ": 0, "æœªå¡«å¯«": 0 };
    
    checkData.forEach(sect => {
        sect.items.forEach((item, idx) => {
            const key = `s${sect.id}_p${idx}`;
            const res = document.getElementById(`val_${key}`).value || "æœªå¡«å¯«";
            const note = document.getElementById(`note_${key}`).value;
            counts[res]++;
            
            let bgStyle = "border:1px solid #000;";
            if(res === 'å®Œæˆ') bgStyle += "background-color:#e8f5e9; color:#1b5e20;";
            else if(res === 'åŸ·è¡Œä¸­') bgStyle += "background-color:#fffde7; color:#f57f17;";
            else if(res === 'æœªåŸ·è¡Œ') bgStyle += "background-color:#ffebee; color:#b71c1c;";
            
            rows += `
            <tr style="${bgStyle}">
                <td style="background:#f2f2f2; color:#333; font-weight:bold; border:1px solid #000;">${idx===0?sect.title:''}</td>
                <td style="border:1px solid #000;">${item.p}</td>
                <td style="text-align:center; font-weight:bold; border:1px solid #000;">${res}</td>
                <td style="border:1px solid #000;">${note}</td>
            </tr>`;
        });
    });

    const html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><style>
        body{font-family:"Microsoft JhengHei",sans-serif; padding:30px; color:#333;}
        .header { text-align: center; border-bottom: 3px solid #0288d1; margin-bottom: 20px; padding-bottom: 10px; }
        table{width:100%; border-collapse:collapse; margin-top:20px;} 
        th,td{border:1px solid #000; padding:10px; font-size:14px; vertical-align: top;}
        .summary-box { margin-top: 20px; font-weight: bold; border: 2px solid #eee; padding: 15px; border-radius: 8px; }
        .sig-img { height: 80px; border-bottom: 1px solid #000; display: block; margin-top: 10px; }
    </style></head><body>
        <div class="header"><h2>è·å ´ä¸æ³•ä¾µå®³é é˜²æªæ–½æŸ¥æ ¸åŠè©•ä¼°å ±å‘Š</h2></div>
        <p>æŸ¥æ ¸æ—¥æœŸï¼š${document.getElementById('evalDate').value}</p>
        <table>
            <thead><tr><th width="20%">é …ç›®</th><th width="25%">æª¢æ ¸é‡é»</th><th width="15%">çµæœ</th><th>ç¾æ³èªªæ˜ / æ”¹å–„æƒ…å½¢</th></tr></thead>
            <tbody>${rows}</tbody>
        </table>
        
        <div class="summary-box">
            çµæœçµ±è¨ˆï¼š
            <span style="color:#1b5e20;">â— å®Œæˆ (${counts['å®Œæˆ']})</span> &nbsp;
            <span style="color:#f57f17;">â— åŸ·è¡Œä¸­ (${counts['åŸ·è¡Œä¸­']})</span> &nbsp;
            <span style="color:#b71c1c;">â— æœªåŸ·è¡Œ (${counts['æœªåŸ·è¡Œ']})</span>
            ${counts['æœªå¡«å¯«'] > 0 ? ' &nbsp; <span style="color:#aaa;">â— æœªå¡« ('+counts['æœªå¡«å¯«']+')</span>' : ''}
        </div>

        <div style="margin-top:40px;">
            <div>è·å®‰äººå“¡ç°½ç« ï¼š<br><img src="${canvas.toDataURL()}" class="sig-img"></div>
        </div>
    </body></html>`;
    
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([html], {type: "text/html"}));
    a.download = `ä¸æ³•ä¾µå®³æŸ¥æ ¸è©•ä¼°å ±å‘Š_${document.getElementById('evalDate').value}.html`;
    a.click();
}
</script>
</body>
</html>

